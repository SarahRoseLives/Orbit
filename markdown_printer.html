<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Markdown to PDF Pretty Printer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Prism.js for syntax highlighting -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet"/>
  <style>
    html, body {
      height: 100%;
      background: #f6f6fa;
      margin: 0;
      padding: 0;
      color: #222;
    }
    body {
      min-height: 100vh;
    }
    #container {
      max-width: 900px;
      margin: 2em auto;
      background: #fff;
      border-radius: 8px;
      padding: 2em;
      box-shadow: 0 2px 8px #ccc;
      box-sizing: border-box;
    }
    h1, h2, h3, h4, h5, h6 {
      color: #2c3e50;
      margin-top: 1.5em;
      line-height: 1.2;
    }
    textarea {
      width: 100%;
      min-height: 180px;
      font-size: 1em;
      font-family: 'Fira Mono', 'Consolas', monospace;
      padding: 1em;
      border: 1px solid #bbb;
      border-radius: 6px;
      margin-bottom: 1em;
      background: #fcfcfc;
      box-sizing: border-box;
      resize: vertical;
    }
    #rendered {
      margin-top: 2em;
      background: #fff;
      padding: 2em;
      border-radius: 6px;
      border: 1px solid #eee;
      box-sizing: border-box;
      min-height: 200px;
      font-size: 1.09em;
      -webkit-print-color-adjust: exact !important;
      print-color-adjust: exact !important;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin: 1em 0;
      background: #fafafa;
    }
    th, td {
      border: 1px solid #bbb;
      padding: 0.5em 1em;
    }
    blockquote {
      border-left: 4px solid #b4b4b4;
      background: #f4f4f4;
      color: #555;
      margin: 1em 0;
      padding: 0.5em 1.5em;
      font-style: italic;
    }
    pre, code {
      background: #f6f8fa;
      border-radius: 5px;
      font-family: 'Fira Mono', 'Consolas', monospace;
    }
    pre {
      padding: 1em;
      overflow: auto;
      margin: 1em 0;
      border: 1px solid #ddd;
    }
    code {
      padding: 0.1em 0.3em;
      font-size: 0.98em;
    }
    ul, ol {
      margin: 1em 0 1em 2em;
    }
    #pdf-btn {
      background: #e67e22;
      color: #fff;
      border: none;
      padding: 0.7em 1.6em;
      border-radius: 5px;
      font-size: 1em;
      cursor: pointer;
      float: right;
      margin-left: 1em;
    }
    #pdf-btn:hover {
      background: #b86011;
    }
    #render-btn {
      background: #375a7f;
      color: #fff;
      border: none;
      padding: 0.7em 1.6em;
      border-radius: 5px;
      font-size: 1em;
      cursor: pointer;
      float: right;
    }
    #render-btn:hover {
      background: #26394d;
    }
    .controls {
      margin-bottom: 1.5em;
      overflow: auto;
    }
    #instructions {
      margin-bottom: 1em;
      color: #444;
    }
  </style>
</head>
<body>
  <div id="container">
    <h1>Markdown to PDF Pretty Printer</h1>
    <div id="instructions">
      <p>Paste your markdown below and click <b>Render</b>. Use <b>Download PDF</b> for a PDF version.<br>
      <a href="https://www.markdownguide.org/cheat-sheet/" target="_blank" rel="noopener">Markdown Cheat Sheet</a></p>
    </div>
    <div class="controls">
      <button id="pdf-btn" onclick="downloadPDF()">Download PDF</button>
      <button id="render-btn" onclick="renderMarkdown()">Render</button>
    </div>
    <textarea id="markdown" placeholder="Paste your markdown here..."># Example

Paste your **markdown** here!

- Tables, lists, code, headers, etc.
- Download as PDF for a clean sheet.
</textarea>
    <div id="rendered"></div>
  </div>
  <!-- Marked.js and Prism.js -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markdown.min.js"></script>
  <!-- html2canvas and jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    marked.setOptions({
      gfm: true,
      breaks: true,
      smartypants: true,
      highlight: function(code, lang) {
        if(Prism.languages[lang]) {
          return Prism.highlight(code, Prism.languages[lang], lang);
        } else {
          return Prism.highlight(code, Prism.languages.markup, 'markup');
        }
      }
    });

    function renderMarkdown() {
      const src = document.getElementById("markdown").value;
      const html = marked.parse(src);
      document.getElementById("rendered").innerHTML = html;
      Prism.highlightAll();
    }
    renderMarkdown();

    async function downloadPDF() {
      // Ensure fresh rendering
      renderMarkdown();
      const rendered = document.getElementById('rendered');
      // Use html2canvas to render #rendered to a canvas
      const canvas = await html2canvas(rendered, {
        scale: 2, // higher scale = better quality
        backgroundColor: "#fff"
      });
      const imgData = canvas.toDataURL('image/png');
      // Get PDF size in points (1pt = 1/72in). A4 is 595x842pt, Letter is 612x792pt
      const pdf = new window.jspdf.jsPDF({
        orientation: 'p',
        unit: 'pt',
        format: 'letter' // Change to 'a4' if you want A4
      });
      const pageWidth = pdf.internal.pageSize.getWidth();
      const pageHeight = pdf.internal.pageSize.getHeight();
      // Scale image to fit page width, keep aspect ratio
      const imgWidth = pageWidth - 40; // 20pt margin each side
      const imgHeight = canvas.height * (imgWidth / canvas.width);

      let position = 20;
      let remainingHeight = imgHeight;
      let imgY = 20;

      if(imgHeight < pageHeight - 40) {
        pdf.addImage(imgData, 'PNG', 20, 20, imgWidth, imgHeight);
      } else {
        // Multi-page logic
        let renderedHeight = 0;
        let pageNum = 0;
        while(remainingHeight > 0) {
          if(pageNum > 0) pdf.addPage();
          const cropHeight = Math.min(canvas.height - renderedHeight, (pageHeight - 40) * (canvas.height / imgHeight));
          const pageCanvas = document.createElement('canvas');
          pageCanvas.width = canvas.width;
          pageCanvas.height = cropHeight;
          const ctx = pageCanvas.getContext('2d');
          ctx.fillStyle = "#fff";
          ctx.fillRect(0, 0, pageCanvas.width, pageCanvas.height);
          ctx.drawImage(canvas, 0, -renderedHeight);
          const pageImgData = pageCanvas.toDataURL('image/png');
          pdf.addImage(pageImgData, 'PNG', 20, 20, imgWidth, (pageCanvas.height * imgWidth / canvas.width));
          renderedHeight += cropHeight;
          remainingHeight -= (pageHeight - 40);
          pageNum++;
        }
      }

      pdf.save('markdown.pdf');
    }
  </script>
</body>
</html>